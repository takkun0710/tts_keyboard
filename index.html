<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>シンプルTTS</title>
  <style>
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans JP',sans-serif; margin: 2em; line-height: 1.6; }
    textarea { width: 100%; height: 200px; font-size: 16px; }
    .status { margin-top: 10px; color: #555; }
    kbd { background: #eee; border: 1px solid #aaa; border-radius: 3px; padding: 2px 4px; font-size: 0.9em; }
  </style>
</head>
<body>
  <h1>シンプル読み上げ（キーボード操作）</h1>
  <p>テキストを入力して <kbd>Ctrl</kbd>+<kbd>Enter</kbd> で読み上げ</p>
  <textarea id="input" placeholder="ここにテキストを入力"></textarea>
  <div class="status" id="status">準備中…</div>

  <h2>ショートカット一覧</h2>
  <ul>
    <li><kbd>Alt</kbd>+<kbd>Enter</kbd> … 読み上げ開始</li>
    <li><kbd>Alt</kbd>+<kbd>K</kbd> … 停止</li>
    <li><kbd>Alt</kbd>+<kbd>↑</kbd>/<kbd>↓</kbd> … 再生速度 ±0.1（0.5〜2.5）</li>
    <li><kbd>Alt</kbd>+<kbd>→</kbd>/<kbd>←</kbd> … ピッチ ±0.1（0.5〜2.0）</li>
  </ul>

<script>
(() => {
  const ta = document.getElementById("input");
  const status = document.getElementById("status");
  let fixedVoice = null;
  let rate = 1.0;
  let pitch = 1.0;

  // 日本語音声を1つ選択（見つからなければ最初の音声）
  function pickVoice() {
    const voices = speechSynthesis.getVoices();
    if (voices.length === 0) return;
    fixedVoice = voices.find(v => (v.lang || "").toLowerCase().startsWith("ja")) || voices[0];
    status.textContent = "使用音声: " + (fixedVoice.name || "default") + " (" + (fixedVoice.lang || "?") + ")";
  }

  // 読み上げ
  function speak() {
    const text = ta.value.trim();
    if (!text) { status.textContent = "テキストが空です"; return; }
    speechSynthesis.cancel(); // 既存を停止してから
    const u = new SpeechSynthesisUtterance(text);
    if (fixedVoice) u.voice = fixedVoice;
    u.rate = rate;
    u.pitch = pitch;
    u.onend = () => { status.textContent = "完了"; };
    u.onerror = (e) => { status.textContent = "エラー: " + e.error; };
    status.textContent = `読み上げ中…（速度:${rate.toFixed(1)} ピッチ:${pitch.toFixed(1)}）`;
    speechSynthesis.speak(u);
  }

  // 停止
  function stop() {
    speechSynthesis.cancel();
    status.textContent = "停止";
  }

  // イベント登録
  speechSynthesis.onvoiceschanged = pickVoice;
  window.addEventListener("load", () => {
    // 一部環境での遅延対策
    setTimeout(pickVoice, 200);
  });

  // キー操作
  document.addEventListener("keydown", e => {
    if (e.altKey && e.key === "Enter") { e.preventDefault(); speak(); }
    if (e.altKey && (e.key === "k" || e.key === "K")) { e.preventDefault(); stop(); }
    if (e.altKey && e.key === "ArrowUp")   { e.preventDefault(); rate = Math.min(2.5, rate + 0.1); status.textContent = `速度:${rate.toFixed(1)}`; }
    if (e.altKey && e.key === "ArrowDown") { e.preventDefault(); rate = Math.max(0.5, rate - 0.1); status.textContent = `速度:${rate.toFixed(1)}`; }
    if (e.altKey && e.key === "ArrowRight"){ e.preventDefault(); pitch = Math.min(2.0, pitch + 0.1); status.textContent = `ピッチ:${pitch.toFixed(1)}`; }
    if (e.altKey && e.key === "ArrowLeft") { e.preventDefault(); pitch = Math.max(0.5, pitch - 0.1); status.textContent = `ピッチ:${pitch.toFixed(1)}`; }
  });
})();
</script>
</body>
</html>